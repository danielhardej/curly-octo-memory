name: Deploy Storage Account
on:
    push:
        paths:
            - 'storage_accounts/**'

permissions: write-all

jobs:
    job1:
        name: Set outputs in PowerShell script
        runs-on: windows-latest
        outputs:
            changedFiles: ${{ steps.find-diff.outputs.changedFiles }}
        steps:
            - uses: actions/checkout@v4
            - id: find-diff
              shell: pwsh
              run: |
                changed_files=$(git diff --name-only HEAD HEAD~1 -- ./subdirectory)
                if [[ -n "$changed_files" ]]; then
                    echo "changedFiles=$changed_files" >> $GITHUB_OUTPUT
                else
                    echo "No files have been changed in ./subdirectory"
                fi

    job2:
        name: Print outputs in PowerShell script
        needs: job1
        runs-on: windows-latest
        steps:     
            - env:
                # CLIENT_ID: ${{ secrets.CLIENT_ID }}
                # CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
                # SUBSCRIPTION_ID: ${{ secrets.SUBSCRIPTION_ID }}
                # TENANT_ID: ${{ secrets.TENANT_ID }}
                CHANGED_FILES: ${{needs.job1.outputs.changedFiles}}
              shell: pwsh
              run: echo "$CHANGED_FILES"